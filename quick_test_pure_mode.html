<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæµ‹è¯•çº¯å‡€æ¨¡å¼</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: bold; text-align: center; }
        .status.pure { background: #d4edda; border: 2px solid #28a745; color: #155724; }
        .status.fay { background: #fff3cd; border: 2px solid #ffc107; color: #856404; }
        .button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 16px; }
        .button:hover { background: #0056b3; }
        .button.success { background: #28a745; }
        .input-group { margin: 15px 0; }
        textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .result { margin-top: 20px; padding: 15px; border-radius: 6px; }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– çº¯å‡€AIæ¨¡å¼å¿«é€Ÿæµ‹è¯•</h1>
        
        <div class="status pure">
            <h3>âœ… çº¯å‡€AIåŠ©æ‰‹æ¨¡å¼</h3>
            <p>è¿™ä¸ªé¡µé¢ç›´æ¥è°ƒç”¨çº¯å‡€LLM APIï¼Œä¸åŒ…å«ä»»ä½•è§’è‰²è®¾å®š</p>
        </div>
        
        <div class="input-group">
            <label><strong>è¾“å…¥ä½ çš„é—®é¢˜ï¼š</strong></label>
            <textarea id="userMessage" rows="3" placeholder="ä¾‹å¦‚ï¼šä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±">ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±</textarea>
        </div>
        
        <button class="button" onclick="testPureMode()">ğŸš€ å‘é€çº¯å‡€AIè¯·æ±‚</button>
        <button class="button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        
        <div id="results"></div>
        
        <div class="input-group">
            <label><strong>è°ƒè¯•æ—¥å¿—ï¼š</strong></label>
            <div id="debugLog" class="log">ç­‰å¾…æ“ä½œ...</div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 6px;">
            <h4>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</h4>
            <ul>
                <li><strong>çº¯å‡€æ¨¡å¼</strong>ï¼šç›´æ¥ä¸LLMå¯¹è¯ï¼Œæ— è§’è‰²è®¾å®šï¼Œæ— è®°å¿†</li>
                <li><strong>é¢„æœŸå›å¤</strong>ï¼šåº”è¯¥æ˜¯ç®€æ´çš„è‡ªæˆ‘ä»‹ç»ï¼Œä¸ä¼šè¯´"ä¸»äºº"</li>
                <li><strong>å¦‚æœè¿˜æœ‰é—®é¢˜</strong>ï¼šæŸ¥çœ‹è°ƒè¯•æ—¥å¿—äº†è§£è¯¦ç»†ä¿¡æ¯</li>
            </ul>
        </div>
    </div>

    <script>
        function addLog(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function testPureMode() {
            const message = document.getElementById('userMessage').value.trim();
            if (!message) {
                alert('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹');
                return;
            }
            
            const resultsDiv = document.getElementById('results');
            
            addLog('=== å¼€å§‹çº¯å‡€AIæµ‹è¯• ===');
            addLog(`ç”¨æˆ·æ¶ˆæ¯: ${message}`);
            addLog('è°ƒç”¨API: /api/direct-llm');
            
            try {
                const response = await fetch('/api/direct-llm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({"message": message})
                });
                
                addLog(`HTTPçŠ¶æ€: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addLog(`APIå“åº”: ${JSON.stringify(data)}`);
                    
                    if (data.success) {
                        resultsDiv.innerHTML = `
                            <div class="result success">
                                <h4>âœ… çº¯å‡€AIå›å¤æˆåŠŸ</h4>
                                <p><strong>æ¨¡å‹:</strong> ${data.model || 'æœªçŸ¥'}</p>
                                <p><strong>å›å¤å†…å®¹:</strong></p>
                                <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 10px; border-left: 4px solid #28a745;">
                                    ${data.reply || 'æ— å›å¤'}
                                </div>
                            </div>
                        `;
                        addLog('âœ… æµ‹è¯•æˆåŠŸå®Œæˆ');
                        
                        // æ£€æŸ¥å›å¤ä¸­æ˜¯å¦åŒ…å«"ä¸»äºº"
                        if (data.reply && data.reply.includes('ä¸»äºº')) {
                            addLog('âš ï¸ è­¦å‘Š: å›å¤ä¸­ä»åŒ…å«"ä¸»äºº"ç§°å‘¼ï¼Œè¿™ä¸åº”è¯¥å‡ºç°åœ¨çº¯å‡€æ¨¡å¼ä¸­');
                        } else {
                            addLog('âœ… ç¡®è®¤: å›å¤ä¸­æ²¡æœ‰è§’è‰²è®¾å®šç›¸å…³å†…å®¹');
                        }
                    } else {
                        resultsDiv.innerHTML = `
                            <div class="result error">
                                <h4>âŒ APIè°ƒç”¨å¤±è´¥</h4>
                                <p><strong>é”™è¯¯:</strong> ${data.error || 'æœªçŸ¥é”™è¯¯'}</p>
                            </div>
                        `;
                        addLog(`âŒ APIè¿”å›é”™è¯¯: ${data.error}`);
                    }
                } else {
                    const errorText = await response.text();
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            <h4>âŒ HTTPé”™è¯¯</h4>
                            <p><strong>çŠ¶æ€ç :</strong> ${response.status}</p>
                            <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${errorText}</p>
                        </div>
                    `;
                    addLog(`âŒ HTTPé”™è¯¯ ${response.status}: ${errorText}`);
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h4>âŒ ç½‘ç»œé”™è¯¯</h4>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p>è¯·ç¡®ä¿FayæœåŠ¡æ­£åœ¨è¿è¡Œ (http://127.0.0.1:5000)</p>
                    </div>
                `;
                addLog(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('debugLog').textContent = 'æ—¥å¿—å·²æ¸…é™¤...\n';
        }
        
        // æ”¯æŒå›è½¦é”®å‘é€
        document.getElementById('userMessage').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                testPureMode();
            }
        });
        
        addLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
    </script>
</body>
</html>